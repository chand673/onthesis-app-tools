{% extends "layout.html" %}

{% block title %}Statistik Deskriptif - OnThesis{% endblock %}

{% block page_styles %}
<!-- Pustaka JavaScript yang Diperlukan -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html-docx-js/dist/html-docx.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
    /* Gaya untuk menandai input yang error */
    .input-error {
        border-color: #ef4444 !important;
        box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
    }
    /* Gaya untuk output hasil dengan tab */
    .nav-tabs .nav-link {
        background-color: var(--bg-canvas);
        border: 1px solid var(--border-panel);
        color: var(--text-secondary);
        border-radius: 0.5rem 0.5rem 0 0;
        margin-right: 2px;
        padding: 0.5rem 1rem;
        cursor: pointer;
    }
    .nav-tabs .nav-link.active {
        background-color: var(--accent-cyan);
        color: white;
        border-color: var(--accent-cyan);
    }
    .tab-content {
        background-color: var(--bg-canvas);
        border: 1px solid var(--border-panel);
        border-top: none;
        padding: 1.5rem;
        border-radius: 0 0 0.5rem 0.5rem;
    }
    /* Gaya Tabel SPSS */
    table.spss-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
    }
    table.spss-table thead .spss-title-row th {
        background-color: transparent !important;
        color: var(--text-primary) !important;
        font-size: 1.1em;
        font-weight: bold;
        padding: 8px 0;
        text-align: left;
        border-bottom: 2px solid var(--text-primary) !important;
        border-top: 2px solid var(--text-primary) !important;
    }
    table.spss-table thead .spss-header-row th {
        color: var(--text-primary) !important;
        font-weight: bold;
        padding: 8px;
        border-bottom: 1px solid var(--border-panel) !important;
    }
    table.spss-table tbody td {
        padding: 8px;
        color: var(--text-secondary) !important;
        border-bottom: 1px solid var(--border-panel);
    }
    table.spss-table tr:last-child td {
        border-bottom: 2px solid var(--text-primary) !important;
    }
    .plots-container img {
        width: 100%;
        height: auto;
        border-radius: 0.5rem;
        border: 1px solid var(--border-panel);
    }
    
    /* --- PERBAIKAN: Gaya untuk Teks Interpretasi AI --- */
    .interpretation-content h4 {
        font-size: 1.1rem; /* Sedikit lebih besar dari teks biasa */
        font-weight: 600;
        color: var(--text-primary);
        margin-top: 1rem;
        margin-bottom: 0.5rem;
    }
    .interpretation-content p {
        font-size: 0.95rem;
        line-height: 1.6;
        color: var(--text-secondary);
        margin-bottom: 1rem;
    }
    .interpretation-content p:last-child {
        margin-bottom: 0;
    }
    .interpretation-content strong {
        color: var(--text-primary);
    }
    .interpretation-content em {
        font-style: italic;
        color: var(--text-secondary);
    }
</style>
{% endblock %}

{% block content %}
<div class="animate-fade-in-up">
    <header class="mb-8 text-center">
        <h1 class="text-4xl font-extrabold text-text-primary">Analisis Statistik Deskriptif</h1>
        <p class="text-lg text-text-secondary mt-1">Dapatkan ringkasan statistik dan visualisasi dari data Anda.</p>
    </header>

    <div class="max-w-6xl mx-auto space-y-8">
        
        <!-- Kartu Input -->
        <div class="apex-card p-6">
            <h3 class="text-xl font-bold text-text-primary mb-4 text-center">1. Input Data Variabel</h3>
            <p class="text-sm text-text-secondary mb-4 max-w-2xl mx-auto text-center">Masukkan data untuk setiap variabel yang ingin dianalisis. Anda dapat menambah atau menghapus variabel sesuai kebutuhan.</p>
            
            <div id="variablesContainer" class="space-y-4 text-left">
                <!-- Variabel data dinamis -->
            </div>

            <div class="flex flex-wrap gap-4 mt-4 pt-4 border-t border-border-panel">
                <button id="addVariable" class="btn-secondary flex-1">+ Tambah Variabel</button>
                <button id="removeVariable" class="btn-secondary flex-1">- Hapus Variabel</button>
                <button id="loadSample" class="btn-secondary flex-1">Muat Contoh</button>
            </div>
            
            <div class="mt-6 pt-6 border-t border-border-panel">
                <div class="flex justify-center">
                    <button id="runAnalysis" class="btn-primary w-full md:w-1/2">Jalankan Analisis</button>
                </div>
            </div>
        </div>
        
        <!-- Pesan Error Dinamis -->
        <div id="error-container" class="apex-card p-4 bg-red-500/10 border-red-500/30 text-red-400" style="display: none;"></div>


        <!-- Kontainer Output -->
        <div id="outputContainer" class="space-y-4" style="display:none;">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-text-primary">Hasil Analisis</h2>
                <div class="flex gap-2">
                    <button id="export-pdf-btn" class="btn-secondary text-sm flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        <span class="btn-text">Export PDF</span>
                    </button>
                    <button id="export-doc-btn" class="btn-secondary text-sm flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4.5V20a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4.5M16 4.5h-4a2 2 0 0 0-2 2v0a2 2 0 0 0 2 2h4M16 4.5V2M8 13h8M8 17h8"></path></svg>
                        <span class="btn-text">Export DOC</span>
                    </button>
                    <div class="spinner hidden ml-2 w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"></div>
                </div>
            </div>
            <div id="results-tabs-nav" class="nav nav-tabs"></div>
            <div id="results-tabs-content" class="tab-content"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
<script>
$(document).ready(function() {
    let analysisData = null; // Simpan hasil lengkap dari server

    const showError = (message) => {
        $('#error-container').text(message).slideDown();
        $('html, body').animate({ scrollTop: $("#error-container").offset().top - 80 }, 500);
    };

    const createVariable = (name = '', data = '') => {
        const varCount = $('#variablesContainer').children().length + 1;
        const varName = name || `Variabel ${varCount}`;
        const varHtml = `
            <div class="data-variable p-4 border border-border-panel rounded-lg bg-bg-canvas">
                <div class="flex justify-between items-center mb-2">
                    <input type="text" class="bg-transparent font-semibold text-text-primary focus:outline-none w-full variable-name-input" value="${varName}" placeholder="Nama Variabel">
                    <button class="text-text-secondary hover:text-red-400 remove-variable-btn text-xl font-bold" title="Hapus Variabel Ini">&times;</button>
                </div>
                <textarea class="feedback-form-input data-input" placeholder="Masukkan data numerik, pisahkan dengan koma, spasi, atau baris baru...">${data}</textarea>
            </div>
        `;
        $('#variablesContainer').append(varHtml);
    };

    createVariable();

    $('#addVariable').click(() => createVariable());
    
    $('#removeVariable').click(function() {
        if ($('#variablesContainer > .data-variable').length > 1) {
            $('#variablesContainer > .data-variable').last().remove();
        } else {
            showError('Minimal harus ada satu variabel.');
        }
    });

    $('#variablesContainer').on('click', '.remove-variable-btn', function() {
        if ($('#variablesContainer > .data-variable').length > 1) {
            $(this).closest('.data-variable').remove();
        } else {
            showError('Minimal harus ada satu variabel.');
        }
    });

    $('#loadSample').click(() => {
        $('#variablesContainer').empty();
        createVariable('Tinggi_Badan_cm', '165, 170, 155, 180, 168, 172, 160, 175, 166, 159');
        createVariable('Skor_IQ', '110, 112, 105, 120, 115, 118, 108, 122, 113, 109');
    });

    const displayResults = (data) => {
        const tabsNav = $('#results-tabs-nav').empty();
        const tabsContent = $('#results-tabs-content').empty();

        data.columns.forEach((colName, index) => {
            const stats = data.results[colName];
            if (!stats) return;

            const safeColName = colName.replace(/[^a-zA-Z0-9]/g, '_');
            const isActive = index === 0;

            tabsNav.append(`<button class="nav-link ${isActive ? 'active' : ''}" data-bs-target="#tab-${safeColName}" type="button">${colName}</button>`);
            
            const formatNum = (num) => {
                if (num === null || num === undefined) return 'N/A';
                let formatted = parseFloat(Number(num).toFixed(3));
                return formatted.toLocaleString('id-ID', { maximumFractionDigits: 3 });
            };

            const tabContentHtml = `
                <div class="tab-pane fade ${isActive ? 'show active' : ''}" id="tab-${safeColName}">
                    <div class="apex-card p-6 mb-8">
                        <table id="table-${safeColName}" class="spss-table"></table>
                        <div class="text-sm text-text-secondary mt-2 text-right">N (Jumlah Data Valid) = ${stats.n}</div>
                    </div>
                    <div class="apex-card p-6">
                        <h3 class="text-xl font-bold text-text-primary mb-4 text-center">Visualisasi Distribusi</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 plots-container">
                            <img id="hist-${safeColName}" src="${data.plots[colName+'_histogram']}" alt="Histogram of ${colName}">
                            <img id="boxplot-${safeColName}" src="${data.plots[colName+'_boxplot']}" alt="Boxplot of ${colName}">
                            ${data.plots[colName+'_piechart'] ? `<img id="pie-${safeColName}" src="${data.plots[colName+'_piechart']}" alt="Pie Chart of ${colName}">` : '<div class="flex items-center justify-center h-full bg-bg-canvas border border-border-panel rounded-lg"><p class="text-center text-text-secondary">Pie chart tidak dapat dibuat.</p></div>'}
                        </div>
                    </div>
                    <div class="apex-card p-6 mt-8">
                        <h4 class="text-lg font-bold text-text-primary mb-2">Interpretasi AI</h4>
                        <button class="btn-secondary w-full mb-4 interpret-btn" data-col-name="${colName}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-accent-cyan"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                            <span class="btn-text">Jelaskan Hasil Ini</span>
                            <div class="spinner hidden ml-2 w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"></div>
                        </button>
                        <div id="interpretation-${safeColName}" class="interpretation-content bg-bg-canvas p-4 rounded-lg border border-border-panel" style="display: none;"></div>
                    </div>
                </div>`;
            tabsContent.append(tabContentHtml);

            const table = $(`#table-${safeColName}`);
            table.html(`
                <thead>
                    <tr class="spss-title-row"><th colspan="2">Statistik Deskriptif: ${colName}</th></tr>
                    <tr class="spss-header-row"><th>Ukuran</th><th>Nilai</th></tr>
                </thead>
                <tbody>
                    <tr><td><strong>Mean</strong></td><td>${formatNum(stats.mean)}</td></tr>
                    <tr><td><strong>Median</strong></td><td>${formatNum(stats.median)}</td></tr>
                    <tr><td><strong>Modus</strong></td><td>${Array.isArray(stats.mode) ? stats.mode.join(', ') : 'N/A'}</td></tr>
                    <tr><td><strong>Std. Deviasi</strong></td><td>${formatNum(stats.std)}</td></tr>
                    <tr><td><strong>Varian</strong></td><td>${formatNum(stats.variance)}</td></tr>
                    <tr><td><strong>Range</strong></td><td>${formatNum(stats.range)}</td></tr>
                    <tr><td><strong>Minimum</strong></td><td>${formatNum(stats.min)}</td></tr>
                    <tr><td><strong>Maksimum</strong></td><td>${formatNum(stats.max)}</td></tr>
                </tbody>`);
        });
        
        $('#outputContainer').slideDown();
        $('html, body').animate({ scrollTop: $("#outputContainer").offset().top - 80 }, 500);
    };

    $('#runAnalysis').click(async function() {
        $('#error-container').hide().empty();
        $('.input-error').removeClass('input-error');
        let hasError = false;
        const dataForAnalysis = {};
        const variableNames = new Set();

        $('.data-variable').each(function() {
            const varEl = $(this);
            const nameInput = varEl.find('.variable-name-input');
            const name = nameInput.val().trim();
            const textarea = varEl.find('.data-input');
            const rawDataStr = textarea.val().trim();
            
            if (rawDataStr === '') return;

            if (!name) {
                hasError = true;
                nameInput.addClass('input-error');
            } else if (variableNames.has(name)) {
                hasError = true;
                nameInput.addClass('input-error');
                showError(`Nama variabel duplikat: "${name}". Harap gunakan nama yang unik.`);
                return false;
            }
            variableNames.add(name);

            const values = rawDataStr.split(/[ ,\n\t;]+/).map(Number).filter(x => !isNaN(x));
            if (values.length < 2) {
                hasError = true;
                textarea.addClass('input-error');
            } else {
                dataForAnalysis[name] = values;
            }
        });

        if (hasError) {
            showError('Setiap variabel harus punya nama unik dan minimal 2 data numerik. Bagian yang bermasalah telah ditandai.');
            return;
        }
        if (Object.keys(dataForAnalysis).length === 0) {
            showError('Tidak ada data valid untuk dianalisis.');
            return;
        }

        const button = $(this);
        button.prop('disabled', true).text('Menganalisis...');

        try {
            const response = await fetch(`{{ url_for('api_descriptive_analysis') }}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataForAnalysis)
            });
            if (!response.ok) {
                const errData = await response.json();
                throw new Error(errData.error || 'Terjadi kesalahan pada server');
            }
            analysisData = await response.json();
            displayResults(analysisData);
        } catch (e) {
            showError('Error: ' + e.message);
        } finally {
            button.prop('disabled', false).text('Jalankan Analisis');
        }
    });

    $('#results-tabs-nav').on('click', '.nav-link', function(e) {
        e.preventDefault();
        $('#results-tabs-nav .nav-link').removeClass('active');
        $('#results-tabs-content .tab-pane').removeClass('show active');
        $(this).addClass('active');
        $($(this).data('bs-target')).addClass('show active');
    });

    // --- PERBAIKAN: PROMPT INTERPRETASI AI ---
    $('#results-tabs-content').on('click', '.interpret-btn', function() {
        const colName = $(this).data('col-name');
        const stats = analysisData.results[colName];
        if (!stats) return;

        const btn = $(this);
        const btnText = btn.find('.btn-text');
        const spinner = btn.find('.spinner');
        btnText.text('Menganalisis...');
        spinner.removeClass('hidden');
        btn.prop('disabled', true);

        const formatNum = (num) => parseFloat(Number(num).toFixed(2)).toLocaleString('id-ID');

        const prompt = `
            Anda adalah seorang analis data ahli. Buat laporan HTML singkat dan lugas untuk data statistik variabel **"${colName}"**.
            Gunakan HANYA tag HTML: <h4> untuk subjudul, <p> untuk penjelasan, <strong> untuk penekanan, dan <em> untuk istilah statistik.
            JANGAN GUNAKAN FORMAT MARKDOWN SAMA SEKALI.

            Data:
            - Mean: ${formatNum(stats.mean)}
            - Median: ${formatNum(stats.median)}
            - Standar Deviasi: ${formatNum(stats.std)}

            Struktur HTML WAJIB diikuti:
            <h4>Tendensi Sentral</h4>
            <p>Jelaskan secara singkat perbandingan antara <em>Mean</em> dan <em>Median</em> di sini. (Contoh: Nilai <em>Mean</em> dan <em>Median</em> hampir sama, menunjukkan sebaran data yang cenderung simetris.)</p>
            <h4>Sebaran Data</h4>
            <p>Jelaskan secara singkat arti dari nilai <em>Standar Deviasi</em>. (Contoh: Standar deviasi sebesar ${formatNum(stats.std)} menunjukkan data cukup mengumpul di sekitar rata-rata.)</p>
            <h4>Kesimpulan</h4>
            <p>Berikan satu kalimat kesimpulan umum tentang karakteristik data ini.</p>
        `;
        
        $.ajax({
            url: "{{ url_for('interpret_analysis') }}",
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ stats: prompt }),
            success: (res) => {
                const safeColName = colName.replace(/[^a-zA-Z0-9]/g, '_');
                // Membersihkan sisa markdown jika AI masih gagal patuh
                let cleanedHtml = res.interpretation.replace(/^```html\s*|```\s*$/g, '').trim();
                cleanedHtml = cleanedHtml.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>');
                $(`#interpretation-${safeColName}`).html(cleanedHtml).slideDown();
            },
            error: (err) => {
                const safeColName = colName.replace(/[^a-zA-Z0-9]/g, '_');
                $(`#interpretation-${safeColName}`).html(`<p class="text-red-400">Gagal: ${err.responseJSON ? err.responseJSON.error : 'Error'}</p>`).slideDown();
            },
            complete: () => {
                btnText.text('Jelaskan Hasil Ini');
                spinner.addClass('hidden');
                btn.prop('disabled', false);
            }
        });
    });

    // --- Export Logic ---
    const loadImageAsBase64 = (url) => {
        return new Promise((resolve, reject) => {
            if (!url) {
                resolve(null);
                return;
            }
            const img = new Image();
            img.crossOrigin = 'Anonymous';
            img.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                resolve(canvas.toDataURL('image/png'));
            };
            img.onerror = () => reject(new Error('Gagal memuat gambar untuk ekspor.'));
            img.src = url;
        });
    };

    const exportHandler = async (format) => {
        if (!analysisData) {
            showError("Lakukan analisis terlebih dahulu sebelum mengekspor.");
            return;
        }
        
        const btn = $(`#export-${format}-btn`);
        const spinner = btn.siblings('.spinner').first();
        btn.prop('disabled', true);
        spinner.removeClass('hidden');

        if (format === 'doc') {
            try {
                const checkResponse = await fetch("{{ url_for('check_pro_trial_usage') }}", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ feature: 'export_doc' })
                });
                const checkData = await checkResponse.json();
                if (!checkData.allowed) {
                    showError(checkData.message);
                    btn.prop('disabled', false); spinner.addClass('hidden');
                    return;
                }
            } catch (e) {
                showError("Gagal memverifikasi status langganan.");
                btn.prop('disabled', false); spinner.addClass('hidden');
                return;
            }
        }

        try {
            const logoUrl = "{{ url_for('static', filename='images/onthesis-logo-black.png') }}";
            const logoData = await loadImageAsBase64(logoUrl);
            const activeTabId = $('#results-tabs-content .tab-pane.active').attr('id');
            const safeColName = activeTabId.replace('tab-', '');
            const colName = $('#results-tabs-nav .nav-link.active').text();

            if (format === 'pdf') {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                const addHeader = (docInstance) => docInstance.addImage(logoData, 'PNG', docInstance.internal.pageSize.width - 45, 10, 30, 8);
                
                addHeader(doc);
                doc.setFontSize(18);
                doc.text(`Laporan Statistik Deskriptif: ${colName}`, 105, 25, { align: 'center' });
                
                doc.autoTable({ html: `#table-${safeColName}`, startY: 35, theme: 'grid', headStyles: { fillColor: [2, 132, 199] } });
                let yPos = doc.autoTable.previous.finalY + 15;
                
                const histImgSrc = $(`#hist-${safeColName}`).attr('src');
                const boxplotImgSrc = $(`#boxplot-${safeColName}`).attr('src');
                const pieImgSrc = $(`#pie-${safeColName}`).attr('src');

                const histImgData = await loadImageAsBase64(histImgSrc);
                const boxplotImgData = await loadImageAsBase64(boxplotImgSrc);
                const pieImgData = pieImgSrc ? await loadImageAsBase64(pieImgSrc) : null;
                
                if (yPos > 200) { doc.addPage(); addHeader(doc); yPos = 25; }
                doc.setFontSize(14);
                doc.text("Visualisasi Data", 15, yPos);
                yPos += 8;
                doc.addImage(histImgData, 'PNG', 15, yPos, 90, 68);
                doc.addImage(boxplotImgData, 'PNG', 110, yPos, 90, 68);
                yPos += 75;

                if(pieImgData){
                    doc.addImage(pieImgData, 'PNG', 60, yPos, 90, 68); // Centered pie chart
                }

                doc.save(`hasil-deskriptif-${safeColName}.pdf`);

            } else if (format === 'doc') {
                let content = `
                    <style>
                        body { font-family: 'Times New Roman', Times, serif; font-size: 12pt; }
                        h1, h2, h3, h4 { font-family: 'Times New Roman', Times, serif; }
                        table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }
                        th, td { border: 1px solid #000; padding: 6px; text-align: left; }
                        th { font-weight: bold; background-color: #E0E0E0; }
                    </style>
                    <h1>Laporan Statistik Deskriptif: ${colName}</h1>
                    <h4>Tabel Hasil</h4>
                    ${$(`#table-${safeColName}`)[0].outerHTML}
                    <h3>Visualisasi Data</h3>
                `;
                
                const histImgSrc = $(`#hist-${safeColName}`).attr('src');
                const boxplotImgSrc = $(`#boxplot-${safeColName}`).attr('src');
                const pieImgSrc = $(`#pie-${safeColName}`).attr('src');

                const histImgData = await loadImageAsBase64(histImgSrc);
                const boxplotImgData = await loadImageAsBase64(boxplotImgSrc);
                const pieImgData = pieImgSrc ? await loadImageAsBase64(pieImgSrc) : null;

                content += `<h4>Histogram</h4><p><img src="${histImgData}" style="width:450px; height:auto;" /></p>`;
                content += `<h4>Box Plot</h4><p><img src="${boxplotImgData}" style="width:450px; height:auto;" /></p>`;
                if(pieImgData){
                    content += `<h4>Pie Chart</h4><p><img src="${pieImgData}" style="width:450px; height:auto;" /></p>`;
                }

                var converted = htmlDocx.asBlob(content);
                saveAs(converted, `hasil-deskriptif-${safeColName}.doc`);
            }
        } catch (e) {
            console.error("Gagal mengekspor:", e);
            showError("Terjadi kesalahan saat membuat file ekspor.");
        } finally {
            btn.prop('disabled', false);
            spinner.addClass('hidden');
        }
    };

    $('#outputContainer').on('click', '#export-pdf-btn', () => exportHandler('pdf'));
    $('#outputContainer').on('click', '#export-doc-btn', () => exportHandler('doc'));
});
</script>
{% endblock %}
