{% extends "layout.html" %}

{% block title %}Generator Latar Belakang - Asisten AI{% endblock %}

{% block page_styles %}
<!-- Pustaka Ikon -->
<script src="https://unpkg.com/lucide@latest"></script>

<style>
    /* Menggunakan variabel tema dari styles.css */
    .io-panel {
        background-color: var(--bg-panel);
        border: 1px solid var(--border-panel);
        border-radius: 1rem;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    .io-textarea {
        width: 100%;
        min-height: 100px;
        flex-grow: 1;
        padding: 1rem;
        background-color: var(--bg-canvas);
        border: 1px solid var(--border-panel);
        color: var(--text-primary);
        border-radius: 0.75rem;
        resize: none;
        transition: all 0.2s ease;
    }
    .io-textarea:focus {
        outline: none;
        border-color: var(--accent-cyan);
        box-shadow: 0 0 0 3px var(--accent-cyan-glow);
    }
    .io-output {
        width: 100%;
        height: 100%;
        flex-grow: 1;
        overflow-y: auto;
        color: var(--text-secondary);
    }
    .io-output .prose p, .io-output .prose li { color: var(--text-secondary); }
    .io-output .prose strong, .io-output .prose h1, .io-output .prose h2, .io-output .prose h3, .io-output .prose code { color: var(--text-primary); }
    .io-output .prose a { color: var(--accent-cyan); text-decoration: underline; }
    .io-output .prose pre { background-color: var(--bg-canvas); border: 1px solid var(--border-panel); border-radius: 0.5rem; padding: 1rem; }
    
    /* Gaya untuk Wizard/Form Multi-step */
    .wizard-step { display: none; }
    .wizard-step.active { display: block; animation: fade-in-up 0.5s; }
    .step-indicator {
        transition: all 0.3s ease-in-out;
        background-color: var(--border-panel);
    }
    .step-indicator.active {
        background-color: var(--accent-cyan);
        flex-grow: 1.5;
    }

    /* Gaya untuk kontrol dan tombol */
    .control-group label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
    }
    .control-select {
        width: 100%;
        background-color: var(--bg-canvas);
        border: 1px solid var(--border-panel);
        color: var(--text-primary);
        border-radius: 0.5rem;
        padding: 0.5rem 0.75rem;
        -webkit-appearance: none;
        appearance: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%238B949E' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
    }
    .control-select:focus {
        outline: none;
        border-color: var(--accent-cyan);
    }
    
    /* Animasi notifikasi */
    @keyframes fade-in-out {
      0% { opacity: 0; transform: translateY(20px); } 10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(20px); }
    }
    .animate-fade-in-out { animation: fade-in-out 4s ease-in-out forwards; }
</style>
{% endblock %}

{% block content %}
<div class="h-full w-full p-4 sm:p-6 lg:p-8 flex flex-col">
    <!-- Header Halaman Generator -->
    <header class="mb-6 flex-shrink-0 flex items-center gap-4 animate-fade-in-up">
        <!-- Ganti href dengan URL halaman menu Asisten AI Anda -->
        <a href="/writing_assistant" class="back-to-menu btn-secondary !p-2" title="Kembali ke Menu Asisten">
            <i data-lucide="arrow-left"></i>
        </a>
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-primary">Generator Latar Belakang</h1>
            <p class="text-md text-secondary mt-1">Buat draf latar belakang masalah yang terstruktur dan didukung data dalam beberapa langkah.</p>
        </div>
    </header>

    <!-- Konten Utama: Grid 2 Kolom -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 flex-grow overflow-hidden">
        
        <!-- Kolom Kiri: Input & Kontrol -->
        <div class="lg:col-span-5 flex flex-col gap-6">
            <!-- 1. Panel Input Multi-Step -->
            <div class="io-panel flex-grow">
                <!-- Indikator Step -->
                <div class="flex items-center gap-2 mb-6">
                    <div id="step-indicator-1" class="step-indicator active h-2 rounded-full flex-1"></div>
                    <div id="step-indicator-2" class="step-indicator h-2 rounded-full flex-1"></div>
                    <div id="step-indicator-3" class="step-indicator h-2 rounded-full flex-1"></div>
                    <div id="step-indicator-4" class="step-indicator h-2 rounded-full flex-1"></div>
                </div>
                <!-- Form Wizard -->
                <div id="wizard-form" class="flex-grow flex flex-col">
                    <div id="step-1" class="wizard-step active flex-grow flex flex-col">
                        <label for="input-topic" class="font-semibold text-primary mb-2">Langkah 1: Apa Topik Utama Penelitian Anda?</label>
                        <p class="text-sm text-secondary mb-4">Masukkan beberapa kata kunci utama (3-5 kata).</p>
                        <textarea id="input-topic" class="io-textarea" placeholder="Contoh: pengaruh media sosial, kesehatan mental, mahasiswa"></textarea>
                    </div>
                    <div id="step-2" class="wizard-step flex-grow flex flex-col">
                        <label for="input-problem" class="font-semibold text-primary mb-2">Langkah 2: Apa Masalah yang Ingin Diangkat?</label>
                        <p class="text-sm text-secondary mb-4">Jelaskan secara singkat masalah yang Anda amati terkait topik.</p>
                        <textarea id="input-problem" class="io-textarea" placeholder="Contoh: Peningkatan kecemasan dan depresi di kalangan mahasiswa akibat tekanan perbandingan sosial di Instagram."></textarea>
                    </div>
                    <div id="step-3" class="wizard-step flex-grow flex flex-col">
                        <label for="input-goal" class="font-semibold text-primary mb-2">Langkah 3: Apa Tujuan dari Penelitian Ini?</label>
                        <p class="text-sm text-secondary mb-4">Sebutkan apa yang ingin Anda capai atau buktikan.</p>
                        <textarea id="input-goal" class="io-textarea" placeholder="Contoh: Menganalisis hubungan antara intensitas penggunaan Instagram dengan tingkat depresi mahasiswa."></textarea>
                    </div>
                    <div id="step-4" class="wizard-step flex-grow flex flex-col">
                        <label for="input-location" class="font-semibold text-primary mb-2">Langkah 4: Lokasi Penelitian (Opsional)</label>
                        <p class="text-sm text-secondary mb-4">Spesifikkan lokasi jika ada, untuk pencarian data yang lebih akurat.</p>
                        <textarea id="input-location" class="io-textarea" placeholder="Contoh: Universitas Gadjah Mada, Yogyakarta"></textarea>
                    </div>
                </div>
                <!-- Navigasi Wizard -->
                <div class="flex justify-between items-center mt-6">
                    <button id="prev-btn" class="btn-secondary" disabled>Sebelumnya</button>
                    <button id="next-btn" class="btn-primary">Selanjutnya</button>
                </div>
            </div>
            
            <!-- 2. Panel Kontrol -->
            <div class="io-panel flex-shrink-0">
                <h3 class="text-lg font-bold text-primary mb-4">Pengaturan Penulisan</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="control-group">
                        <label for="writing-mode">Mode Penulisan</label>
                        <select id="writing-mode" class="control-select">
                            <option value="academic">Akademik Formal</option>
                            <option value="semi-formal">Semi-Formal</option>
                            <option value="persuasive">Persuasif (Data-driven)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="citation-style">Gaya Sitasi</label>
                        <select id="citation-style" class="control-select">
                            <option value="apa">APA 7</option>
                            <option value="ieee">IEEE</option>
                            <option value="mla">MLA</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kolom Kanan: Output -->
        <div class="lg:col-span-7 flex flex-col">
            <div class="io-panel h-full">
                <!-- Toolbar Output -->
                <div class="flex justify-between items-center mb-4 pb-4 border-b border-[var(--border-panel)]">
                    <h2 class="text-xl font-bold text-primary">Hasil Draf Latar Belakang</h2>
                    <div class="flex items-center gap-2">
                        <div id="originality-indicator" class="hidden items-center gap-2 text-sm bg-green-900/50 text-green-300 px-3 py-1 rounded-full border border-green-500/50">
                            <i data-lucide="shield-check" class="w-4 h-4"></i>
                            <span>Originalitas: <strong id="originality-score">97%</strong></span>
                        </div>
                        <button id="paraphrase-btn" class="btn-secondary !p-2" title="Parafrase Ulang"><i data-lucide="refresh-cw"></i></button>
                        <button id="export-btn" class="btn-secondary !p-2" title="Ekspor Dokumen"><i data-lucide="download"></i></button>
                    </div>
                </div>
                <!-- Konten Output -->
                <div id="output-content" class="io-output prose max-w-none">
                    <div class="h-full flex flex-col justify-center items-center text-center">
                        <i data-lucide="file-input" class="w-16 h-16 text-secondary/50 mb-4"></i>
                        <h3 class="text-lg font-semibold text-primary">Lengkapi Input Anda</h3>
                        <p class="text-secondary">Isi formulir di sebelah kiri dan tekan "Generate" untuk memulai.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Kontainer Notifikasi -->
<div id="notification-container" class="fixed bottom-5 right-5 z-50 w-full max-w-sm"></div>
{% endblock %}

{% block page_scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Inisialisasi Elemen ---
    const wizardSteps = document.querySelectorAll('.wizard-step');
    const stepIndicators = document.querySelectorAll('.step-indicator');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const outputContent = document.getElementById('output-content');
    const originalityIndicator = document.getElementById('originality-indicator');
    
    let currentStep = 0;

    // --- Fungsi untuk merender ikon (lebih aman) ---
    const renderIcons = () => {
        if (window.lucide) {
            window.lucide.createIcons();
        }
    };

    // --- Logika Wizard (Form Multi-Step) ---
    const updateWizard = () => {
        wizardSteps.forEach((step, index) => {
            step.classList.toggle('active', index === currentStep);
        });
        stepIndicators.forEach((indicator, index) => {
            indicator.classList.toggle('active', index <= currentStep);
        });
        prevBtn.disabled = currentStep === 0;

        // Mengganti tombol "Selanjutnya" menjadi "Generate" di langkah terakhir
        if (currentStep === wizardSteps.length - 1) {
            nextBtn.innerHTML = `<i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>Generate`;
            nextBtn.className = 'btn bg-green-500 hover:bg-green-600 text-white'; // Menggunakan className untuk mereset dan menerapkan gaya baru
        } else {
            nextBtn.innerHTML = `Selanjutnya`;
            nextBtn.className = 'btn-primary'; // Kembali ke gaya tombol utama
        }
        renderIcons();
    };

    nextBtn.addEventListener('click', () => {
        if (currentStep < wizardSteps.length - 1) {
            currentStep++;
            updateWizard();
        } else {
            // Tombol menjadi "Generate" di langkah terakhir
            handleGeneration();
        }
    });

    prevBtn.addEventListener('click', () => {
        if (currentStep > 0) {
            currentStep--;
            updateWizard();
        }
    });

    // --- Fungsi Notifikasi ---
    const showNotification = (message, type = 'success') => {
        const container = document.getElementById('notification-container');
        const icon = type === 'error' ? `<i data-lucide="x-circle"></i>` : `<i data-lucide="check-circle"></i>`;
        const bgColor = type === 'error' ? 'bg-red-500' : 'bg-cyan-500';
        const notif = document.createElement('div');
        notif.className = `flex items-center gap-3 px-4 py-3 text-white ${bgColor} rounded-lg shadow-2xl mb-2 animate-fade-in-out`;
        notif.innerHTML = `${icon}<span>${message}</span>`;
        container.appendChild(notif);
        renderIcons();
        setTimeout(() => { notif.remove(); }, 4000);
    };

    // --- Logika Inti: Generate Konten (Simulasi) ---
    const handleGeneration = () => {
        const topic = document.getElementById('input-topic').value;
        if (!topic) {
            showNotification('Langkah 1 (Topik) tidak boleh kosong.', 'error');
            return;
        }

        outputContent.innerHTML = `
            <div class="h-full flex flex-col justify-center items-center text-center">
                <span class="h-10 w-10 animate-spin rounded-full border-4 border-solid border-accent-cyan border-r-transparent mb-4"></span>
                <h3 class="text-lg font-semibold text-primary">AI sedang menganalisis...</h3>
                <p class="text-secondary">Mencari data pendukung dan menyusun struktur...</p>
            </div>
        `;
        originalityIndicator.classList.add('hidden');

        // Simulasi pemanggilan API (delay 3 detik)
        setTimeout(() => {
            const writingMode = document.getElementById('writing-mode').value;
            const citationStyle = document.getElementById('citation-style').value;
            
            const mockResult = `
                <h3 class="font-bold text-primary">1. Pendahuluan</h3>
                <p>Di era digital saat ini, ${topic} telah menjadi bagian tak terpisahkan dari kehidupan sehari-hari, terutama di kalangan mahasiswa. Platform seperti Instagram, TikTok, dan Twitter menawarkan ruang untuk interaksi sosial, namun juga membawa dampak signifikan terhadap berbagai aspek kehidupan pengguna, termasuk kesehatan mental.</p>
                
                <h3 class="font-bold text-primary mt-4">2. Masalah Aktual dan Data Pendukung</h3>
                <p>Studi terbaru menunjukkan tren yang mengkhawatirkan. Menurut survei oleh Asosiasi Psikologi Indonesia (API), terjadi peningkatan laporan gejala kecemasan sebesar 45% di kalangan remaja dan dewasa muda dalam dua tahun terakhir, yang berkorelasi dengan peningkatan waktu layar harian <strong>(API, 2024)</strong>. Data dari BPS juga mencatat bahwa rata-rata penggunaan media sosial di Indonesia kini mencapai 3.5 jam per hari, naik dari 2.8 jam pada tahun 2022 <strong>(BPS, 2023)</strong>. Fenomena ini mengindikasikan adanya masalah nyata yang memerlukan perhatian akademis.</p>
                
                <h3 class="font-bold text-primary mt-4">3. Relevansi dan Kesenjangan Penelitian</h3>
                <p>Meskipun banyak penelitian telah membahas dampak umum media sosial, studi yang secara spesifik menganalisis mekanisme perbandingan sosial di Instagram dan hubungannya dengan gejala depresi pada konteks mahasiswa di Indonesia masih terbatas. Penelitian ini penting untuk mengisi kesenjangan tersebut dan memberikan pemahaman yang lebih mendalam mengenai faktor risiko psikologis di lingkungan akademik lokal.</p>
                
                <h3 class="font-bold text-primary mt-4">4. Transisi ke Rumusan Masalah</h3>
                <p>Berdasarkan urgensi dan kesenjangan yang telah diuraikan, maka penelitian ini bertujuan untuk menjawab bagaimana intensitas penggunaan Instagram dan tingkat perbandingan sosial secara bersamaan memengaruhi tingkat depresi pada mahasiswa. Mode penulisan saat ini: <strong>${writingMode}</strong>. Gaya sitasi: <strong>${citationStyle}</strong>.</p>
            `;
            
            outputContent.innerHTML = mockResult;
            originalityIndicator.classList.remove('hidden');
            originalityIndicator.classList.add('flex');
            showNotification('Draf latar belakang berhasil dibuat!', 'success');
        }, 3000);
    };

    // --- Event Listeners untuk Tombol Lainnya (Simulasi) ---
    document.getElementById('paraphrase-btn').addEventListener('click', () => showNotification('Fitur parafrase akan memproses ulang teks...', 'success'));
    document.getElementById('export-btn').addEventListener('click', () => showNotification('Dokumen akan diekspor dalam format yang dipilih...', 'success'));

    // Inisialisasi awal
    updateWizard();
    renderIcons();
});
</script>
{% endblock %}
