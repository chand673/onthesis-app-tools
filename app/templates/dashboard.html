{% extends "layout.html" %}

{% block title %}Dasbor - OnThesis{% endblock %}

{% block content %}
<!-- [BARU] Kanvas untuk partikel interaktif -->
<canvas id="particle-canvas"></canvas>

<div class="relative z-10 animate-fade-in-up">
    <div class="flex justify-center mb-8">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="OnThesis Logo" class="h-24">
    </div>

    <header class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-extrabold text-white">Selamat Datang Bor!, {{ current_user.username }}!</h1>
        <p class="text-lg text-gray-400 mt-2 max-w-2xl mx-auto">Semua alat bantu skripsi Lu ada di sini. Pilih fitur Sesuai kebutuhan Lu!.</p>
    </header>

    <!-- Grid Kartu 3D -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-8">
        
        <!-- Kartu: Search References -->
        <a href="{{ url_for('search_references') }}" class="neural-card group accent-blue animate-fade-in-up" style="animation-delay: 300ms;" data-tilt data-tilt-max="8" data-tilt-speed="400" data-tilt-perspective="1000">
            <div class="neural-card-inner">
                <div class="card-layer-top">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 group-hover:text-white transition-colors"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <h3 class="text-xl font-bold text-white mt-4">Search</h3>
                </div>
                <div class="card-layer-bottom">
                    <p>Temukan jutaan jurnal.</p>
                </div>
            </div>
        </a>

        <!-- Kartu: Manajemen Sitasi -->
        <a href="{{ url_for('citation_management') }}" class="neural-card group accent-blue animate-fade-in-up" style="animation-delay: 400ms;" data-tilt data-tilt-max="8" data-tilt-speed="400" data-tilt-perspective="1000">
             <div class="neural-card-inner">
                <div class="card-layer-top">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 group-hover:text-white transition-colors"><path d="M4 6h16"/><path d="M4 12h16"/><path d="M4 18h16"/></svg>
                    <h3 class="text-xl font-bold text-white mt-4">Sitasi</h3>
                </div>
                <div class="card-layer-bottom">
                    <p>Kelola daftar pustaka.</p>
                </div>
            </div>
        </a>

        <!-- Kartu: Parafrase AI -->
        <a href="{{ url_for('paraphrase_ai') }}" class="neural-card group accent-purple animate-fade-in-up" style="animation-delay: 500ms;" data-tilt data-tilt-max="8" data-tilt-speed="400" data-tilt-perspective="1000">
             <div class="neural-card-inner">
                <div class="card-layer-top">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 group-hover:text-white transition-colors"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                    <h3 class="text-xl font-bold text-white mt-4">Parafrase</h3>
                </div>
                <div class="card-layer-bottom">
                    <p>Tulis ulang kalimat.</p>
                </div>
            </div>
        </a>

        <!-- Kartu: Asisten AI -->
        <a href="{{ url_for('writing_assistant') }}" class="neural-card group accent-purple animate-fade-in-up" style="animation-delay: 600ms;" data-tilt data-tilt-max="8" data-tilt-speed="400" data-tilt-perspective="1000">
             <div class="neural-card-inner">
                <div class="card-layer-top">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 group-hover:text-white transition-colors"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                    <h3 class="text-xl font-bold text-white mt-4">Asisten</h3>
                </div>
                <div class="card-layer-bottom">
                    <p>Bantuan menulis AI.</p>
                </div>
            </div>
        </a>

        <!-- Kartu: Analisis Data -->
        <a href="{{ url_for('data_analysis') }}" class="neural-card group accent-purple animate-fade-in-up" style="animation-delay: 700ms;" data-tilt data-tilt-max="8" data-tilt-speed="400" data-tilt-perspective="1000">
             <div class="neural-card-inner">
                <div class="card-layer-top">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 group-hover:text-white transition-colors"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                    <h3 class="text-xl font-bold text-white mt-4">Analisis</h3>
                </div>
                <div class="card-layer-bottom">
                    <p>Lakukan uji statistik.</p>
                </div>
            </div>
        </a>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
<!-- Memuat library untuk efek 3D pada kartu -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.7.2/dist/vanilla-tilt.min.js"></script>
<script>
    // Inisialisasi Vanilla-Tilt pada semua kartu
    VanillaTilt.init(document.querySelectorAll(".neural-card"), {
        glare: true,
        "max-glare": 0.1,
        gyroscope: false
    });

    // Skrip untuk animasi partikel interaktif
    const canvas = document.getElementById('particle-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let particlesArray;

    const mouse = {
        x: null,
        y: null,
        radius: 150
    }

    window.addEventListener('mousemove', function(event){
        mouse.x = event.x;
        mouse.y = event.y;
    });

    class Particle {
        constructor(x, y, directionX, directionY, size, color){
            this.x = x;
            this.y = y;
            this.directionX = directionX;
            this.directionY = directionY;
            this.size = size;
            this.color = color;
        }
        draw(){
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
            ctx.fillStyle = 'rgba(138, 92, 254, 0.1)';
            ctx.fill();
        }
        update(){
            if (this.x > canvas.width || this.x < 0) {
                this.directionX = -this.directionX;
            }
            if (this.y > canvas.height || this.y < 0) {
                this.directionY = -this.directionY;
            }

            let dx = mouse.x - this.x;
            let dy = mouse.y - this.y;
            let distance = Math.sqrt(dx*dx + dy*dy);
            if (distance < mouse.radius + this.size){
                if (mouse.x < this.x && this.x < canvas.width - this.size * 10){
                    this.x += 5;
                }
                if (mouse.x > this.x && this.x > this.size * 10){
                    this.x -= 5;
                }
                if (mouse.y < this.y && this.y < canvas.height - this.size * 10){
                    this.y += 5;
                }
                if (mouse.y > this.y && this.y > this.size * 10){
                    this.y -= 5;
                }
            }
            this.x += this.directionX;
            this.y += this.directionY;
            this.draw();
        }
    }

    function init(){
        particlesArray = [];
        let numberOfParticles = (canvas.height * canvas.width) / 9000;
        for (let i = 0; i < numberOfParticles * 0.5; i++){
            let size = (Math.random() * 5) + 1;
            let x = (Math.random() * ((innerWidth - size * 2) - (size * 2)) + size * 2);
            let y = (Math.random() * ((innerHeight - size * 2) - (size * 2)) + size * 2);
            let directionX = (Math.random() * .4) - .2;
            let directionY = (Math.random() * .4) - .2;
            let color = 'rgba(138, 92, 254, 0.1)';
            particlesArray.push(new Particle(x, y, directionX, directionY, size, color));
        }
    }

    function animate(){
        requestAnimationFrame(animate);
        ctx.clearRect(0,0,innerWidth, innerHeight);
        for (let i = 0; i < particlesArray.length; i++){
            particlesArray[i].update();
        }
        connect();
    }

    function connect(){
        let opacityValue = 1;
        for (let a = 0; a < particlesArray.length; a++){
            for (let b = a; b < particlesArray.length; b++){
                let distance = ((particlesArray[a].x - particlesArray[b].x) * (particlesArray[a].x - particlesArray[b].x))
                + ((particlesArray[a].y - particlesArray[b].y) * (particlesArray[a].y - particlesArray[b].y));
                if (distance < (canvas.width/7) * (canvas.height/7)){
                    opacityValue = 1 - (distance/20000);
                    ctx.strokeStyle = 'rgba(138, 92, 254,' + opacityValue * 0.1 + ')';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
                    ctx.lineTo(particlesArray[b].x, particlesArray[b].y);
                    ctx.stroke();
                }
            }
        }
    }
    
    window.addEventListener('resize', function(){
        canvas.width = innerWidth;
        canvas.height = innerHeight;
        mouse.radius = ((canvas.height/80) * (canvas.height/80));
        init();
    });

    init();
    animate();
</script>
{% endblock %}
